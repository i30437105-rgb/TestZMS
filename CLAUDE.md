# Правила проекта TestZMS

## Обязательно при старте сессии

1. Прочитай `DESIGN_SOURCE.md` — главный справочник дизайна (лендинг = первоисточник стиля)
2. Прочитай `PROMPT_DESIGN_SYNC.md` — промпт и правила работы по синхронизации дизайна
3. Проверь текущее состояние: какие решения уже утверждены (таблица в `DESIGN_SOURCE.md`)

## Обязательно после каждого утверждённого блока

1. Зафиксируй решение в `DESIGN_SOURCE.md` → таблица "Утверждённые решения"
2. Обнови любые связанные документы если нужно
3. Это КРИТИЧНО — при потере контекста файлы остаются, а память чата — нет

## Обязательно при восстановлении контекста (после сжатия или новой сессии)

1. Прочитай `DESIGN_SOURCE.md` полностью
2. Проверь таблицу утверждённых решений — это твоя "память"
3. Проверь текущее состояние компонентов (прочитай файлы, которые менялись)
4. Подтверди заказчику: "Восстановил контекст. Вот что уже сделано: [список]. Продолжаем с [блок]?"
5. НЕ продолжай работу молча — сначала убедись, что ничего не упущено

## Маршруты

- `/` → redirect на `/landing` (cleanUrls убирает .html)
- `/test` → тест (React)
- `/landing` → лендинг (статический HTML, `public/landing/index.html`)

## КРИТИЧНО: пути в лендинге — только абсолютные

Все пути в `public/landing/index.html` и `styles.css` ДОЛЖНЫ быть абсолютными (с префиксом `/landing/`).
- `src="/landing/assets/icons/..."` — правильно
- `src="assets/icons/..."` — НЕПРАВИЛЬНО, сломает сайт
- `href="/landing/styles.css"` — правильно
- `href="styles.css"` — НЕПРАВИЛЬНО

**Причина:** `vercel.json` содержит `cleanUrls: true`, URL отображается как `/landing` (без `.html`). При относительных путях браузер ищет ассеты от корня `/`, а не от `/landing/`. Абсолютные пути решают эту проблему.

**При добавлении новых картинок/иконок/файлов в лендинг — ВСЕГДА использовать абсолютный путь.**

## Обязательно: git commit + push после каждой доработки

**КРИТИЧНО**: После каждого завершённого блока работы (утверждённая правка, фикс, новая фича) ассистент ОБЯЗАН:

1. `git add` — добавить изменённые файлы
2. `git commit` — с понятным сообщением на русском, формат: `[Тип] Краткое описание`
   - Типы: `[Feature]`, `[Fix]`, `[Design]`, `[Docs]`, `[Release]`
3. `git push origin master` — залить на GitHub

Это НЕ опционально. Без пуша изменения не попадают на Vercel и теряются при смене сессии.

## Деплой

- GitHub: `https://github.com/i30437105-rgb/TestZMS.git`
- Хостинг: Vercel (автодеплой при push в master)
- Переменные окружения на Vercel: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`

## Ключевые правила

- Лендинг (`public/landing/`) = первоисточник дизайна для всего проекта
- НЕ менять то, о чём не просили
- Работать пошагово, один блок за раз
- Спрашивать, если неоднозначно
- Дизайн-решения принимает только заказчик
- **Если задача затягивается (>5 мин попыток) — сразу запроси у пользователя альтернативу.** Не тратить время на перебор вариантов, если пользователь может быстро помочь (прислать файл заново, уточнить данные и т.д.)

## Задачи на будущее (фронт работ)

### 1. Свой домен
- ~~Купить домен~~
- ~~В Vercel: Settings → Domains → Add Domain → прописать DNS~~
- ~~SSL-сертификат Vercel выдаёт автоматически~~
- Домены: `metodzms.ru` (основной), `test.metodzms.ru` (тест)
- **Статус**: ВЫПОЛНЕНО (09.02.2026)

### 2. Яндекс.Метрика (отслеживание трафика и конверсий)
- ~~Создать счётчик в metrika.yandex.ru~~ — счётчик `103707469`
- ~~Вставить код счётчика~~ — добавлен в `app/layout.jsx`, `public/landing/index.html`, `public/privacy.html`, `public/offer.html`
- ~~Включить Вебвизор для записи сессий~~ — включён (webvisor:true)
- ~~Настроить цели (конверсии)~~ — 8 целей reachGoal добавлены в код:
  - `projti-krash-test` — лендинг: все кнопки «Пройти краш-тест» (script.js)
  - `zabrat-bonusy` — лендинг: кнопка «Забрать бонусы» (script.js)
  - `nachat-audit` — стартовый экран теста (page.jsx)
  - `test-stojkij-osnovatel` — рубеж «Стойкий основатель», вопрос 11 (page.jsx)
  - `test-zheleznaya-volya` — рубеж «Железная воля», вопрос 19 (page.jsx)
  - `test-smotret-rezultaty` — кнопка «Смотреть результаты» (CompletionScreen.jsx)
  - `zapisatsya-na-audit` — кнопка «Записаться на аудит» в результатах (ResultsScreen.jsx)
  - `zabrat-bonusy-poddomen` — отправка формы бонусов в результатах (ResultsScreen.jsx)
- Цель 8 (`ostavili-kontakty`) — для другого проекта, не реализована здесь
- **Статус**: ВЫПОЛНЕНО (18.02.2026) — счётчик + 8 целей

### 3. UTM-метки и отслеживание источников (Яндекс.Директ)
- ~~Парсинг UTM-параметров из URL при входе на сайт~~
- ~~Сохранение utm_source, utm_medium, utm_campaign, utm_content в sessionStorage~~
- ~~Передача UTM вместе с данными формы в Telegram-бот~~
- Реализовано: парсинг в `layout.jsx` + `landing/script.js`, передача в Telegram (source/medium/campaign в одну строку)
- **Статус**: ВЫПОЛНЕНО (09.02.2026)

### 4. База данных (сохранение результатов тестов)
- **Бесплатный вариант**: Vercel Postgres (бесплатно до 256 МБ) или Supabase (бесплатно до 500 МБ)
- Что сохранять:
  - Все ответы пользователя (JSON)
  - Результат теста (процент, зелёные/красные блоки)
  - Данные формы (имя, Telegram)
  - UTM-метки
  - Дата/время прохождения
  - User-Agent, IP (опционально)
- Создать API route `/api/results` для записи
- Создать простую админку или выгрузку в CSV
- **Статус**: не начато

### 5. Ссылки в кнопках на странице результатов
- ~~**Кнопка «Записаться на аудит»**~~ → ведёт на `audit.metodzms.ru` с UTM + промокод DOBRUSIN
- ~~**Кнопка «Забрать бонусы»**~~ → форма отправляет в Telegram + открывает `t.me/dobrusin_promarketing_bot?start=bonuses`
- **Статус**: ВЫПОЛНЕНО (17.02.2026)

### 6. Пиксель Яндекс.Директ (ретаргетинг)
- Добавить код пикселя Яндекс.Аудиторий на все страницы
- Позволяет показывать рекламу тем, кто уже был на сайте
- **Статус**: не начато

### 7. База данных (НЕ блокер для запуска)
- Сейчас НЕ нужна — данные приходят в Telegram, этого достаточно для старта
- Понадобится позже для аналитики: кто прошёл, какие блоки красные, конверсия в заявку
- **Бесплатно**: Vercel Postgres или Supabase
- **Статус**: отложено, не блокирует запуск рекламы

### 8. Видео на лендинге
- ~~Вставить видео Kinescope в секцию Quote (баннер с фото)~~
- ~~Модальное окно при клике на play-кнопку~~
- ~~Ограничение качества: quality=720p (не грузить 4K/2K)~~
- **Статус**: ВЫПОЛНЕНО (17.02.2026)

### Приоритет выполнения
1. ~~Ссылки в кнопках~~ — ВЫПОЛНЕНО
2. ~~Яндекс.Метрика~~ — ВЫПОЛНЕНО (счётчик 103707469, Вебвизор)
3. ~~UTM-метки~~ — ВЫПОЛНЕНО
4. ~~Домен~~ — ВЫПОЛНЕНО (metodzms.ru + test.metodzms.ru)
5. Пиксель ретаргетинга (после запуска рекламы)
6. База данных (когда понадобится аналитика)
7. ~~Видео на лендинге~~ — ВЫПОЛНЕНО
